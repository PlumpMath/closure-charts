<html>
<head>
<title>JavaScript Charting Unit Tests - Label</title>
<script type="text/javascript" src="http://localhost/closure-library/js/goog/base.js"></script>
<script type="text/javascript" src="http://localhost/javascript-charting-sample/demo/myDeps.js"></script>
<script>
	goog.require('goog.testing.jsunit');
	goog.require('goog.dom');
	
	goog.require('goog.date');
	goog.require('goog.math.Size');
	
	goog.require('scottlogic.chart.Chart');
	goog.require('scottlogic.chart.rendering.DateTimeAxis');
	goog.require('scottlogic.chart.rendering.NumericalAxis');
	goog.require('scottlogic.chart.rendering.LineSeries');
</script>
</head>
<body>
<script>  
    // Clear the canvas after the charts have been tested
    function tearDown(){
        var canvas = goog.dom.$('canvas');
        canvas.innerHTML = '';
    }
    
    function testCenterLocation() {
    	var min = new goog.date.UtcDateTime(2010, goog.date.month.AUG, 5, 12, 0, 0, 0);
        var max = new goog.date.UtcDateTime(2010, goog.date.month.AUG, 6, 12, 0, 0, 0);
        var x = new scottlogic.chart.rendering.DateTimeAxis();
        x.setMinimum(min);
    	x.setMaximum(max);
        
        var y = new scottlogic.chart.rendering.NumericalAxis();
        
        var chart = new scottlogic.chart.Chart("canvas", [300, 300]);
        var series = new scottlogic.chart.rendering.LineSeries("", [[min, -1],[max, 10]]);
        chart.addLineSeries(series);
        chart.redraw();
        
        // padding (40) + tick width (7)
        assertEquals("x Axis - First label center x", chart.xAxis.convertNormalized(chart.xAxisData.getFirstLabelTick()), chart.xAxis.labels[0].center[0]);
        
        // height(300) - padding (20)
        assertEquals("x Axis - First label center y", 300 - chart.paddingX, chart.xAxis.labels[0].center[1]);
        
        assertEquals("yAxis first label point x", chart.paddingY, chart.yAxis.labels[0].center[0]);
        // first point should be -1, so first label should be at this point
        assertEquals("yAxis first label point y", chart.yAxis.convert(-1), chart.yAxis.labels[0].center[1]);
    }
    
    function testIncrement() {
    	var min = new goog.date.UtcDateTime(2010, goog.date.month.AUG, 5, 12, 0, 0, 0);
        var max = new goog.date.UtcDateTime(2010, goog.date.month.AUG, 5, 16, 0, 0, 0);
        var x = new scottlogic.chart.rendering.DateTimeAxis();
        
        var chart = new scottlogic.chart.Chart("canvas", [300, 300]);
        chart.xAxisData.setFormatter(function(i){return i.getMinutes()});
        chart.xAxisData.setMinimum(min);
        chart.xAxisData.setMaximum(max);
    	chart.xAxisData.setStartOfHours(new goog.date.UtcDateTime(1990, 06, 22, 08));
    	chart.xAxisData.setEndOfHours(new goog.date.UtcDateTime(1990, 06, 22, 17));
    	
        var series = new scottlogic.chart.rendering.LineSeries("", [[min, -1],[max, 10]]);
        chart.addLineSeries(series);
        chart.redraw();
        
        /* test interval. note that because the position and the label text are 
        computed using the same value, we can test the text and then, 
        assuming that increment on the axis works, can assume the label is 
        in the correct location */
        assertEquals("interval y", 1, Number(chart.yAxis.labels[1].text_) - Number(chart.yAxis.labels[0].text_));
        
        assertEquals("interval x", 10, Number(chart.xAxis.labels[1].text_) - Number(chart.xAxis.labels[0].text_));
    }
</script>
<div id="canvas"></div>
</body>
</html>
